Attaching to opscore_service_real
[36mopscore_service_real     |[0m INFO:     Will watch for changes in these directories: ['/app']
[36mopscore_service_real     |[0m INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[36mopscore_service_real     |[0m INFO:     Started reloader process [1] using WatchFiles
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:36.268830+00:00", "level": "INFO", "name": "root", "message": "Logging configured with level INFO. Outputting JSON to stdout.", "pathname": "/app/opscore/logging_config.py", "lineno": 101, "funcName": "setup_logging"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.489517+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/internal/agent/notify", "method": "POST", "client": "172.25.0.3:56956"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.493473+00:00", "level": "INFO", "name": "opscore.api", "message": "Registering agent 'TestSimulatedAgent' with ID from notification: 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/api.py", "lineno": 103, "funcName": "agent_notification"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.493682+00:00", "level": "INFO", "name": "opscore.lifecycle", "message": "Attempting to register agent: TestSimulatedAgent with ID: 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 37, "funcName": "register_agent"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.494842+00:00", "level": "INFO", "name": "opscore.storage", "message": "Registration saved for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 47, "funcName": "save_agent_registration"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.495009+00:00", "level": "INFO", "name": "opscore.lifecycle", "message": "Agent 'TestSimulatedAgent' registration data saved successfully with ID: 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 57, "funcName": "register_agent"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.495076+00:00", "level": "INFO", "name": "opscore.lifecycle", "message": "Setting state for agent 39a97542-985f-4a8a-89f4-ede564f64573 to 'UNKNOWN'", "pathname": "/app/opscore/lifecycle.py", "lineno": 96, "funcName": "set_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.495255+00:00", "level": "INFO", "name": "opscore.storage", "message": "State saved for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 113, "funcName": "save_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.495355+00:00", "level": "INFO", "name": "opscore.lifecycle", "message": "State for agent 39a97542-985f-4a8a-89f4-ede564f64573 updated to 'UNKNOWN'", "pathname": "/app/opscore/lifecycle.py", "lineno": 130, "funcName": "set_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.495435+00:00", "level": "INFO", "name": "opscore.lifecycle", "message": "Initial state 'UNKNOWN' set for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 62, "funcName": "register_agent"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.495512+00:00", "level": "INFO", "name": "opscore.api", "message": "Successfully registered agent 39a97542-985f-4a8a-89f4-ede564f64573 via notification.", "pathname": "/app/opscore/api.py", "lineno": 109, "funcName": "agent_notification"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.496198+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/internal/agent/notify", "status_code": 200, "method": "POST", "process_time_ms": 6.8}
[36mopscore_service_real     |[0m INFO:     172.25.0.3:56956 - "POST /v1/opscore/internal/agent/notify HTTP/1.1" 200 OK
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:45.796057+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:45.797071+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:45.797189+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:45.802446+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:45.803866+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 7.87}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:46.814039+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:46.815118+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:46.815281+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:46.817047+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:46.818575+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.56}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:47.829373+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:47.830647+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:47.830789+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:47.832236+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:47.833802+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.52}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:48.842047+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:48.843660+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:48.843837+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:48.845787+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:48.848972+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 7.02}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:49.879333+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:49.880240+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:49.880341+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:49.881921+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:49.883522+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.24}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:50.895302+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:50.896413+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:50.896558+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:50.898756+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:50.900684+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 5.4}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:51.953949+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:51.954880+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:51.955043+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:51.956790+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:51.959052+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 5.12}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:52.968903+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:52.969700+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:52.969819+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:52.971446+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:52.973635+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.72}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:53.978788+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:53.979279+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:53.979350+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:53.980410+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:53.981628+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 2.84}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:54.985975+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:54.986843+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:54.986985+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:54.988665+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:54.992317+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 6.32}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:55.998595+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:55.999613+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:55.999765+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:56.001050+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:56.002742+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.11}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:57.009408+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:57.010313+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:57.010463+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:57.012678+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:57.014854+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 5.45}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:58.022566+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:58.023751+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:58.024031+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:58.026930+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:58.029138+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 6.72}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:59.035514+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:59.036457+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:59.036621+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:59.038417+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:59.041377+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 5.85}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:00.049345+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:00.050399+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:00.050546+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:00.051726+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:00.052959+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 3.64}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:01.058611+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:01.059618+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:01.059730+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:01.060863+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:01.062803+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 3.96}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:02.068727+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:02.069568+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:02.069695+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:02.071862+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:02.074450+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 5.7}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:03.079892+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:03.080453+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:03.080534+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:03.081543+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:03.082413+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 2.53}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:04.087795+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:04.088658+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:04.088802+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:04.090527+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:04.092436+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.63}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:05.100339+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:05.101481+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:05.101639+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:05.103285+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:05.105203+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.89}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:06.116174+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:06.118779+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:06.118963+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:06.120671+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:06.122533+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 6.4}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:07.129373+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:07.130131+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:07.130231+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:07.131359+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:07.132479+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 3.12}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:08.138888+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:08.140451+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:08.140644+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:08.143032+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:08.145447+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 6.59}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:09.151620+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:09.152263+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:09.152368+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:09.153777+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:09.156818+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 5.15}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:10.163338+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:10.163916+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:10.164002+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:10.164810+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:10.165630+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 2.31}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:11.168874+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:11.169676+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:11.169780+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:11.170946+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:11.172183+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 3.31}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:12.177916+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:12.178965+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:12.179110+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:12.180610+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:12.182323+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.42}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:13.190637+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:13.191538+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:13.191685+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:13.193326+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:13.195323+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.66}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:14.201736+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:14.202362+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:14.202453+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:14.203888+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:14.205394+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 3.65}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:15.211572+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:15.212250+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:15.212383+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:15.213695+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:15.215059+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 3.5}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:16.220099+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:16.221284+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:16.221459+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:16.223527+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:16.226408+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 6.22}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:17.231317+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:17.232030+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:17.232130+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:17.233290+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:17.234637+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 3.33}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:18.242203+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:18.243518+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:18.244070+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:18.245789+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:18.247376+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 5.15}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:19.251811+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:19.252465+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:19.252559+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:19.253869+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:19.255486+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 3.68}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:20.262271+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:20.263285+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:20.263443+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:20.264950+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:20.266584+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.32}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:21.272432+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:21.276880+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:21.277012+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:21.278026+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:21.279160+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 6.83}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:22.283767+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:22.284268+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:22.284353+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:22.285211+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:22.286123+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 2.37}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:23.291616+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:23.293359+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:23.293463+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:23.294332+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:23.295122+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 3.66}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:24.299312+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:24.300221+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:24.300369+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:24.301837+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:24.303562+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.26}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:25.310386+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:25.311228+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:25.311329+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:25.312778+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:25.314303+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 3.93}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:26.321377+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:26.322612+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:26.322772+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:26.324573+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:26.328514+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 7.13}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:27.333927+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:27.334780+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:27.334913+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:27.336695+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:27.339248+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 5.3}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:28.346077+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:28.346626+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:28.346711+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:28.347567+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:28.348296+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 2.23}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:29.352456+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:29.352952+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:29.353053+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:29.354052+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:29.355449+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 2.99}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:30.360850+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:30.361453+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:30.361554+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:30.362654+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:30.363588+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 2.75}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
