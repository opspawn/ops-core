Attaching to opscore_service_real
[36mopscore_service_real     |[0m INFO:     Will watch for changes in these directories: ['/app']
[36mopscore_service_real     |[0m INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[36mopscore_service_real     |[0m INFO:     Started reloader process [1] using WatchFiles
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:36.268830+00:00", "level": "INFO", "name": "root", "message": "Logging configured with level INFO. Outputting JSON to stdout.", "pathname": "/app/opscore/logging_config.py", "lineno": 101, "funcName": "setup_logging"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.489517+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/internal/agent/notify", "method": "POST", "client": "172.25.0.3:56956"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.493473+00:00", "level": "INFO", "name": "opscore.api", "message": "Registering agent 'TestSimulatedAgent' with ID from notification: 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/api.py", "lineno": 103, "funcName": "agent_notification"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.493682+00:00", "level": "INFO", "name": "opscore.lifecycle", "message": "Attempting to register agent: TestSimulatedAgent with ID: 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 37, "funcName": "register_agent"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.494842+00:00", "level": "INFO", "name": "opscore.storage", "message": "Registration saved for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 47, "funcName": "save_agent_registration"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.495009+00:00", "level": "INFO", "name": "opscore.lifecycle", "message": "Agent 'TestSimulatedAgent' registration data saved successfully with ID: 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 57, "funcName": "register_agent"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.495076+00:00", "level": "INFO", "name": "opscore.lifecycle", "message": "Setting state for agent 39a97542-985f-4a8a-89f4-ede564f64573 to 'UNKNOWN'", "pathname": "/app/opscore/lifecycle.py", "lineno": 96, "funcName": "set_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.495255+00:00", "level": "INFO", "name": "opscore.storage", "message": "State saved for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 113, "funcName": "save_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.495355+00:00", "level": "INFO", "name": "opscore.lifecycle", "message": "State for agent 39a97542-985f-4a8a-89f4-ede564f64573 updated to 'UNKNOWN'", "pathname": "/app/opscore/lifecycle.py", "lineno": 130, "funcName": "set_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.495435+00:00", "level": "INFO", "name": "opscore.lifecycle", "message": "Initial state 'UNKNOWN' set for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 62, "funcName": "register_agent"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.495512+00:00", "level": "INFO", "name": "opscore.api", "message": "Successfully registered agent 39a97542-985f-4a8a-89f4-ede564f64573 via notification.", "pathname": "/app/opscore/api.py", "lineno": 109, "funcName": "agent_notification"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:41.496198+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/internal/agent/notify", "status_code": 200, "method": "POST", "process_time_ms": 6.8}
[36mopscore_service_real     |[0m INFO:     172.25.0.3:56956 - "POST /v1/opscore/internal/agent/notify HTTP/1.1" 200 OK
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:45.796057+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:45.797071+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:45.797189+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:45.802446+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:45.803866+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 7.87}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:46.814039+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:46.815118+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:46.815281+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:46.817047+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:46.818575+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.56}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:47.829373+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:47.830647+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:47.830789+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:47.832236+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:47.833802+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.52}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:48.842047+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:48.843660+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:48.843837+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:48.845787+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:48.848972+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 7.02}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:49.879333+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:49.880240+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:49.880341+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:49.881921+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:49.883522+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.24}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:50.895302+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:50.896413+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:50.896558+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:50.898756+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:50.900684+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 5.4}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:51.953949+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:51.954880+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:51.955043+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:51.956790+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:51.959052+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 5.12}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:52.968903+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:52.969700+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:52.969819+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:52.971446+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:52.973635+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.72}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:53.978788+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:53.979279+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:53.979350+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:53.980410+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:53.981628+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 2.84}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:54.985975+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:54.986843+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:54.986985+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:54.988665+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:54.992317+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 6.32}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:55.998595+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:55.999613+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:55.999765+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:56.001050+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:56.002742+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.11}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:57.009408+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:57.010313+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:57.010463+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:57.012678+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:57.014854+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 5.45}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:58.022566+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:58.023751+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:58.024031+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:58.026930+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:58.029138+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 6.72}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:59.035514+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:59.036457+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:59.036621+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:59.038417+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:18:59.041377+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 5.85}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:00.049345+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:00.050399+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:00.050546+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:00.051726+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:00.052959+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 3.64}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:01.058611+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:01.059618+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:01.059730+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:01.060863+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:01.062803+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 3.96}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:02.068727+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:02.069568+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:02.069695+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:02.071862+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:02.074450+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 5.7}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:03.079892+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:03.080453+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:03.080534+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:03.081543+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:03.082413+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 2.53}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:04.087795+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:04.088658+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:04.088802+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:04.090527+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:04.092436+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.63}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:05.100339+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:05.101481+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:05.101639+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:05.103285+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:05.105203+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.89}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:06.116174+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:06.118779+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:06.118963+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:06.120671+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:06.122533+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 6.4}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:07.129373+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:07.130131+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:07.130231+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:07.131359+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:07.132479+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 3.12}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:08.138888+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:08.140451+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:08.140644+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:08.143032+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:08.145447+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 6.59}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:09.151620+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:09.152263+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:09.152368+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:09.153777+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:09.156818+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 5.15}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:10.163338+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:10.163916+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:10.164002+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:10.164810+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:10.165630+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 2.31}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:11.168874+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:11.169676+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:11.169780+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:11.170946+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:11.172183+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 3.31}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:12.177916+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:12.178965+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:12.179110+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:12.180610+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:12.182323+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.42}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:13.190637+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:13.191538+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:13.191685+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:13.193326+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:13.195323+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.66}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:14.201736+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:14.202362+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:14.202453+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:14.203888+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:14.205394+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 3.65}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:15.211572+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:15.212250+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:15.212383+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:15.213695+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:15.215059+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 3.5}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:16.220099+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:16.221284+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:16.221459+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:16.223527+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:16.226408+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 6.22}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:17.231317+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:17.232030+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:17.232130+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:17.233290+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:17.234637+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 3.33}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:18.242203+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:18.243518+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:18.244070+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:18.245789+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:18.247376+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 5.15}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:19.251811+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:19.252465+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:19.252559+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:19.253869+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:19.255486+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 3.68}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:20.262271+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:20.263285+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:20.263443+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:20.264950+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:20.266584+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.32}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:21.272432+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:21.276880+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:21.277012+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:21.278026+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:21.279160+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 6.83}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:22.283767+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:22.284268+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:22.284353+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:22.285211+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:22.286123+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 2.37}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:23.291616+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:23.293359+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:23.293463+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:23.294332+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:23.295122+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 3.66}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:24.299312+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:24.300221+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:24.300369+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:24.301837+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:24.303562+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 4.26}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:25.310386+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:25.311228+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:25.311329+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:25.312778+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:25.314303+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 3.93}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:26.321377+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:26.322612+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:26.322772+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:26.324573+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:26.328514+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 7.13}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:27.333927+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:27.334780+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:27.334913+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:27.336695+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:27.339248+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 5.3}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:28.346077+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:28.346626+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:28.346711+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:28.347567+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:28.348296+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 2.23}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:29.352456+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:29.352952+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:29.353053+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:29.354052+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:29.355449+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 2.99}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:30.360850+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "method": "GET", "client": "172.25.0.1:53828"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:30.361453+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent test-sim-agent-001", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:30.361554+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent test-sim-agent-001", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:30.362654+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:19:30.363588+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "path": "/v1/opscore/agent/test-sim-agent-001/state", "status_code": 500, "method": "GET", "process_time_ms": 2.75}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:53828 - "GET /v1/opscore/agent/test-sim-agent-001/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m WARNING:  WatchFiles detected changes in 'tests/integration/test_real_agentkit_workflow.py'. Reloading...
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:44.367964+00:00", "level": "INFO", "name": "root", "message": "Logging configured with level INFO. Outputting JSON to stdout.", "pathname": "/app/opscore/logging_config.py", "lineno": 101, "funcName": "setup_logging"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:52.033928+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:52.034710+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:52.034825+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:52.037862+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:52.039024+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 5.13}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:53.045005+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:53.046031+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:53.046178+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:53.047601+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:53.048813+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 3.84}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:54.054061+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:54.055285+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:54.055442+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:54.057858+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:54.059563+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 5.53}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:55.065658+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:55.066763+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:55.067009+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:55.069382+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:55.070784+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 5.17}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:56.075914+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:56.076907+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:56.076990+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:56.078028+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:56.078956+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 3.1}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:57.084294+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:57.084876+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:57.084965+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:57.085973+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:57.087070+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 2.78}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:58.091657+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:58.092280+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:58.092378+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:58.093369+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:58.094550+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 2.91}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:59.099580+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:59.100243+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:59.100350+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:59.101536+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:33:59.102405+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 2.83}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:00.106903+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:00.107706+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:00.107858+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:00.109570+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:00.111107+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 4.23}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:01.115410+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:01.115988+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:01.116096+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:01.117063+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:01.118334+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 2.87}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:02.123672+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:02.124172+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:02.124248+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:02.125128+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:02.126063+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 2.4}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:03.130112+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:03.130799+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:03.130876+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:03.131694+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:03.132541+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 2.48}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:04.139003+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:04.140156+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:04.140335+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:04.141970+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:04.143283+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 4.35}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:05.149910+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:05.150975+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:05.151108+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:05.152398+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:05.153408+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 3.56}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:06.158951+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:06.159491+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:06.159557+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:06.160321+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:06.161047+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 2.12}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:07.164840+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:07.165285+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:07.165375+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:07.166079+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:07.166746+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 1.93}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:08.170643+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:08.171857+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:08.172175+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:08.174174+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:08.175841+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 5.2}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:09.181608+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:09.182151+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:09.182230+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:09.183087+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:09.183914+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 2.32}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:10.189982+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:10.191082+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:10.191383+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:10.194083+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:10.195664+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 5.7}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:11.201231+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:11.201950+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:11.202054+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:11.203486+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:11.204701+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 3.52}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:12.210652+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:12.211478+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:12.211602+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:12.212917+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:12.214304+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 3.7}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:13.219109+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:13.220115+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:13.220268+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:13.221457+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:13.222968+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 3.76}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:14.228369+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:14.229013+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:14.229099+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:14.229944+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:14.230784+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 2.44}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:15.235828+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:15.236612+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:15.236736+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:15.237885+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:15.239534+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 3.7}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:16.247183+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:16.247890+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:16.247980+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:16.248883+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:16.249708+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 2.56}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:17.253788+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:17.254281+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:17.254356+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:17.255379+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:17.256452+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 2.67}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:18.261344+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:18.261953+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:18.262011+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:18.262848+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:18.263660+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 2.33}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:19.268296+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:19.269136+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:19.269245+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:19.270573+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:19.272114+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 3.88}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:20.277194+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:20.277959+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:20.278060+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:20.279190+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:20.280312+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 3.13}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:20.866967+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:50252"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:20.868203+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 401, "process_time_ms": 1.24}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:50252 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 401 Unauthorized
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:21.286973+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:21.287890+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:21.288033+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:21.289701+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:21.291203+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 4.23}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:21.599308+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/favicon.ico", "client": "172.25.0.1:50252"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:21.600998+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/favicon.ico", "status_code": 404, "process_time_ms": 1.92}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:50252 - "GET /favicon.ico HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:22.296993+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:22.297976+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:22.298110+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:22.299367+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:22.300793+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 3.82}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:23.306023+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:23.307258+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:23.307343+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:23.308273+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:23.309195+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 3.21}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:24.314583+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:24.315731+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:24.315971+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:24.318427+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:24.321085+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 6.5}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:25.328192+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:25.328827+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:25.328891+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:25.329651+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:25.330311+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 2.15}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:26.333794+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:26.336074+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:26.336196+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:26.337294+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:26.338602+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 4.72}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:27.344863+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:27.345930+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:27.346082+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:27.348189+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:27.357055+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 12.17}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:28.365462+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:28.369138+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:28.370003+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:28.374009+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:28.376152+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 10.68}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:29.383213+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:29.384212+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:29.384397+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:29.386701+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:29.389145+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 5.92}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:30.395639+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:30.397817+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:30.397935+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:30.399096+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:30.400398+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 4.8}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:31.406923+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:31.407922+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:31.407996+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:31.408750+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:31.409441+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 2.69}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:32.413406+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:32.413913+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:32.414011+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:32.414885+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:32.415686+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 2.3}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:33.419787+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:33.420569+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:33.420650+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:33.421648+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:33.423552+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 3.7}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:34.428169+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:34.428659+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:34.428738+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:34.429527+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:34.430278+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 2.13}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:35.434915+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:35.435749+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:35.435910+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:35.437320+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:35.439115+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 4.19}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:36.446802+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "client": "172.25.0.1:52290"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:36.447856+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:36.447970+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:36.449044+00:00", "level": "CRITICAL", "name": "opscore.middleware", "message": "Unhandled exception occurred: 'NoneType' object has no attribute 'state'", "exception": "Traceback (most recent call last):\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\\\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \\\"/app/opscore/middleware.py\\\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 165, in call_next\n    raise app_exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\\\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\\\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 64, in wrapped_app\n    raise exc\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\\\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \\\"/usr/local/lib/python3.11/site-packages/starlette/routing.py\\\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\\\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \\\"/app/opscore/api.py\\\", line 192, in get_agent_state\n    logger.debug(f\\\"Returning state for agent {agent_id}: {agent_state.state}\\\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'", "pathname": "/app/opscore/middleware.py", "lineno": 151, "funcName": "dispatch", "status_code": 500, "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py\", line 104, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/opscore/middleware.py\", line 128, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 756, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 776, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 278, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/opscore/api.py\", line 192, in get_agent_state\n    logger.debug(f\"Returning state for agent {agent_id}: {agent_state.state}\")\n                                                          ^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'state'\n", "method": "GET", "error_type": "AttributeError", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:34:36.450120+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 500, "process_time_ms": 3.33}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:52290 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 500 Internal Server Error
[36mopscore_service_real     |[0m WARNING:  WatchFiles detected changes in 'opscore/api.py'. Reloading...
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:38:12.505238+00:00", "level": "INFO", "name": "root", "message": "Logging configured with level INFO. Outputting JSON to stdout.", "pathname": "/app/opscore/logging_config.py", "lineno": 101, "funcName": "setup_logging"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:10.102623+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:10.114500+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:10.114785+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:10.115230+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:10.117711+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 16.95, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:11.130022+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:11.130965+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:11.131100+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:11.131171+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:11.131830+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.82, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:12.137995+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:12.138914+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:12.139066+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:12.139133+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:12.139888+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.8, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:13.148983+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:13.150014+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:13.150184+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:13.150316+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:13.151282+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 2.32, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:14.158284+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:14.159141+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:14.159260+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:14.159303+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:14.159668+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.41, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:15.164903+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:15.165778+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:15.165919+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:15.165979+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:15.166558+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.67, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:16.175150+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:16.176561+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:16.177243+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:16.177599+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:16.179407+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 4.24, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:17.196500+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:17.197942+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:17.198114+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:17.198227+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:17.199070+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 2.64, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:18.216176+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:18.218122+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:18.218255+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:18.218369+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:18.218993+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 2.96, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:19.227148+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:19.227940+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:19.228046+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:19.228101+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:19.228718+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.57, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:20.233552+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:20.234174+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:20.234269+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:20.234310+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:20.234688+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.15, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:21.239523+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:21.240687+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:21.240774+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:21.240810+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:21.241178+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.66, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:22.246030+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:22.246977+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:22.247128+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:22.247228+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:22.247908+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.9, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:23.254656+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:23.256000+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:23.256168+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:23.256236+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:23.256766+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 2.14, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:24.264319+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:24.265036+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:24.265163+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:24.265218+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:24.265962+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.68, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:25.272376+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:25.274857+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:25.275069+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:25.275160+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:25.275890+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 3.55, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:26.296401+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:26.297747+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:26.297914+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:26.297987+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:26.298856+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 2.51, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:27.308345+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:27.309063+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:27.309169+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:27.309215+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:27.309986+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.57, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:28.314816+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:28.315545+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:28.315663+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:28.315717+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:28.316240+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.45, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:29.322957+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:29.324449+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:29.324600+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:29.324676+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:29.325182+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 2.26, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:30.330598+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:30.331271+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:30.331375+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:30.331421+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:30.332091+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.51, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:31.338632+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:31.339931+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:31.340147+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:31.340343+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:31.341565+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 2.89, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:32.350639+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:32.352169+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:32.352323+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:32.352400+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:32.353088+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 2.48, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:33.361698+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:33.363149+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:33.363266+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:33.363318+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:33.363966+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 2.31, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:34.369372+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:34.370256+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:34.370401+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:34.370483+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:34.371091+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.76, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:35.377762+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:35.378598+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:35.378727+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:35.378795+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:35.379346+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.62, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:36.385072+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:36.385830+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:36.385972+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:36.386023+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:36.386764+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.71, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:37.392144+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:37.392663+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:37.392742+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:37.392779+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:37.393086+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 0.96, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:38.397751+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:38.398558+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:38.398695+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:38.398785+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:38.399387+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.65, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:39.406898+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:39.407763+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:39.407937+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:39.408012+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:39.408703+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.74, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:40.414201+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:40.415126+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:40.415269+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:40.415387+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:40.415934+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.75, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:41.422501+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:41.423323+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:41.423453+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:41.423512+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:41.424008+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.51, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:42.429128+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:42.429721+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:42.429811+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:42.429860+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:42.430380+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.27, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:43.434390+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:43.434954+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:43.435066+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:43.435110+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:43.435557+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.18, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:44.441087+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:44.441741+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:44.441859+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:44.441899+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:44.442260+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.21, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:45.449691+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:45.450616+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:45.450763+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:45.450834+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:45.451468+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.79, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:46.458078+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:46.459217+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:46.459352+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:46.459423+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:46.460002+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.95, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:47.465433+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:47.466349+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:47.466496+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:47.466752+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:47.467379+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 1.96, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:48.476070+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:48.477302+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:48.477458+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:48.477536+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:48.478574+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 2.54, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:49.485667+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:49.487218+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:49.487363+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:49.487561+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:49.488087+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 2.48, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:50.499370+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:50.500997+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:50.501147+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:50.501219+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:50.501977+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 2.59, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:51.526136+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:51.538063+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:51.538303+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:51.538385+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:51.539867+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 13.87, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:52.580681+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:52.582181+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:52.582312+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:52.582366+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:52.583286+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 2.75, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:53.589781+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Incoming request", "pathname": "/app/opscore/middleware.py", "lineno": 54, "funcName": "dispatch", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "method": "GET", "client": "172.25.0.1:47708"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:53.591053+00:00", "level": "WARNING", "name": "opscore.storage", "message": "No state history found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/storage.py", "lineno": 135, "funcName": "read_latest_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:53.591409+00:00", "level": "WARNING", "name": "opscore.lifecycle", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573", "pathname": "/app/opscore/lifecycle.py", "lineno": 154, "funcName": "get_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:53.591475+00:00", "level": "WARNING", "name": "opscore.api", "message": "No state found for agent 39a97542-985f-4a8a-89f4-ede564f64573 during GET state request (lifecycle.get_state returned None). Returning 404.", "pathname": "/app/opscore/api.py", "lineno": 191, "funcName": "get_agent_state"}
[36mopscore_service_real     |[0m {"timestamp": "2025-04-20T21:39:53.592117+00:00", "level": "INFO", "name": "opscore.middleware", "message": "Outgoing response", "pathname": "/app/opscore/middleware.py", "lineno": 71, "funcName": "dispatch", "process_time_ms": 2.38, "method": "GET", "path": "/v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state", "status_code": 404}
[36mopscore_service_real     |[0m INFO:     172.25.0.1:47708 - "GET /v1/opscore/agent/39a97542-985f-4a8a-89f4-ede564f64573/state HTTP/1.1" 404 Not Found
